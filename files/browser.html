<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ethan Browser</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#111;
  --fg:#fff;
  --header:rgba(255,255,255,0.08);
}
body {
  margin:0;
  font-family:'Poppins', sans-serif;
  background:var(--bg);
  color:var(--fg);
  height:100vh;
  display:flex;
  flex-direction:column;
  transition:0.3s ease;
}

/* Header */
header {
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  background:var(--header);
  backdrop-filter:blur(8px);
}
header button {
  padding:6px 10px;
  background:rgba(255,255,255,0.1);
  color:var(--fg);
  border:none;
  border-radius:8px;
  cursor:pointer;
  transition:background 0.3s ease;
}
header button:hover {
  background:rgba(255,255,255,0.25);
}
#urlBar {
  flex:1;
  border:none;
  background:rgba(255,255,255,0.1);
  color:#ccc;
  padding:6px 10px;
  border-radius:8px;
  pointer-events:none;
}

/* Iframe */
iframe {
  flex:1;
  width:100%;
  border:none;
}

/* Footer */
footer {
  text-align:center;
  padding:6px;
  font-size:12px;
  background:var(--header);
  color:#aaa;
}

/* Loading Screen */
#loadingScreen {
  position:fixed;
  inset:0;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  color:#fff;
  z-index:999;
  font-family:'Poppins',sans-serif;
  transition:opacity 0.5s ease;
}
.loader {
  width:40px;
  height:40px;
  border:4px solid rgba(255,255,255,0.3);
  border-top-color:#fff;
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin {
  to { transform:rotate(360deg); }
}

/* Update Popup */
#updatePopup {
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#222;
  color:white;
  border-radius:12px;
  padding:25px 30px;
  box-shadow:0 0 30px rgba(0,0,0,0.5);
  text-align:center;
  display:none;
  z-index:1000;
  width:300px;
}
#updatePopup h2 {
  margin:0 0 10px;
}
#updatePopup button {
  margin-top:10px;
  padding:8px 14px;
  border:none;
  border-radius:8px;
  background:#007bff;
  color:white;
  cursor:pointer;
  transition:background 0.3s ease;
}
#updatePopup button:hover {
  background:#1493ff;
}
</style>
</head>
<body>

<header>
  <button onclick="goHome()">üè† Home</button>
  <button onclick="goGames()">üéÆ Games</button>
  <input id="urlBar" readonly value="Loading...">
</header>

<iframe id="browserFrame"></iframe>

<footer>ethan browser v1.0.1</footer>

<!-- Loading screen -->
<div id="loadingScreen">
  <div class="loader"></div>
  <p style="margin-top:10px;">Loading...</p>
</div>

<!-- Update modal -->
<div id="updatePopup">
  <h2>üîî Browser Update</h2>
  <p id="updateMessage"></p>
  <button id="updateBtn" onclick="updateNow()">Update</button>
  <button id="closeUpdateBtn" onclick="closeUpdate()">Close</button>
</div>

<script>
const allowedDomain = "https://ethanytangcodes.github.io";
const homepage = allowedDomain + "/index.html";
const gamesPage = allowedDomain + "/art";
const version = "1.0.1";
const updateWorker = "https://browserupdate.ethantytang11.workers.dev/version";

const iframe = document.getElementById("browserFrame");
const urlBar = document.getElementById("urlBar");
const loadingScreen = document.getElementById("loadingScreen");

function showLoading(){
  loadingScreen.style.display = "flex";
  loadingScreen.style.opacity = "1";
}
function hideLoading(){
  loadingScreen.style.opacity = "0";
  setTimeout(()=>loadingScreen.style.display="none",500);
}

// --- URL handling ---
function sanitizeUrl(url){
  try {
    const u = new URL(url, homepage);
    if(u.origin === new URL(allowedDomain).origin) return u.href;
    return homepage;
  } catch {
    return homepage;
  }
}

function displayUrlForUI(url){
  if(url === homepage) urlBar.value = "ethan://home";
  else urlBar.value = new URL(url).pathname;
}

function loadPage(url){
  const clean = sanitizeUrl(url);
  showLoading();
  iframe.src = clean;
  displayUrlForUI(clean);
  localStorage.setItem("ethan_lastPage", clean);
}

// --- Buttons ---
function goHome(){ loadPage(homepage); }
function goGames(){ loadPage(gamesPage); }

// --- On load ---
let lastSite = localStorage.getItem("ethan_lastPage");
if(!lastSite || !lastSite.startsWith(allowedDomain)) lastSite = homepage;
loadPage(lastSite);

// Hide loading when iframe loads
iframe.addEventListener("load", hideLoading);

// --- Update Modal ---
async function checkUpdate(){
  try {
    const res = await fetch(updateWorker);
    if(!res.ok) return;
    const data = await res.json();
    const diff = compareVersions(version, data.version);
    const modal = document.getElementById("updatePopup");
    const msg = document.getElementById("updateMessage");
    const closeBtn = document.getElementById("closeUpdateBtn");
    if(diff >= 20){
      msg.innerText = "This version is outdated and must be updated.";
      closeBtn.style.display = "none";
      modal.style.display = "block";
    } else if(diff > 0){
      msg.innerText = data.message || "A new version is available!";
      closeBtn.style.display = "inline-block";
      modal.style.display = "block";
    }
  } catch (err) {
    console.error("Update check failed", err);
  }
}

function compareVersions(v1, v2){
  const a = v1.split(".").map(Number);
  const b = v2.split(".").map(Number);
  return (b[0]-a[0])*100 + (b[1]-a[1])*10 + (b[2]-a[2]);
}

function updateNow(){
  window.location.href = allowedDomain + "/download";
}
function closeUpdate(){
  document.getElementById("updatePopup").style.display = "none";
}

checkUpdate();
</script>

</body>
</html>
